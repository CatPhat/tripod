@using Tripod.Domain.Security
@model CreateLocalMembership

<form id="create_password_form"
      role="form"
      action="@Url.Action(MVC.UserPassword.CreateLocalMembership())"
      method="POST"
      novalidate
      class="form-horizontal"
      data-bind="submit: onSubmit">

    @Html.AntiForgeryToken()

    @Html.ValidationSummary(true)
    @{
        const string inputCss = "input-lg";
        const string inputGroupCss = "input-group input-group-lg";
    }

    @* PASSWORD INPUT *@
    <div class="form-group form-group-lg @Html.BootstrapValidationCssClassFor(x => x.Password, true)" data-bind="css: passwordValidation.fieldCss">

        @* INPUT GROUP COLUMN *@
        <div class="col-md-6">
            @* SR LABEL *@
            <label for="@Html.IdFor(x => x.Password)" class="control-label sr-only">
                @LocalMembership.Constraints.PasswordLabel
            </label>
            @* INPUT GROUP *@
            <div class="@Html.CssClassWhenIsPost(inputGroupCss)" data-bind="css: passwordValidation.inputGroupCss('@inputGroupCss')">
                <input type="password"
                       class="form-control @inputCss"
                       placeholder="@LocalMembership.Constraints.PasswordLabel"
                       id="@Html.IdFor(x => x.Password)"
                       name="password"
                       data-bind="value: password"
                       value=""
                       required />

                <!-- ko with: passwordValidation -->
                <span class="input-group-addon validation @Html.CssClassWhenIsNotPost("hide")" data-bind="css: { hide: hasNoAddOn }">
                    <i class="fa fa-fw fa-times error" data-bind="visible: hasError"></i>
                    <i class="fa fa-fw fa-spinner fa-spin spin-fast spinner" data-bind="visible: isSpinning"></i>
                    <i class="fa fa-fw fa-check success" data-bind="visible: hasSuccess"></i>
                </span>
                <!-- /ko -->
            </div>
        </div>

        @* VALIDATION MESSAGES COLUMNS *@
        <div class="col-md-6 validation help-block">
            @Html.ValidationMessageFor(x => x.Password)
            <span data-bind="validationMessage: password"></span>
        </div>
    </div>

    @* CONFIRM PASSWORD INPUT *@
    <div class="form-group form-group-lg @Html.BootstrapValidationCssClassFor(x => x.ConfirmPassword, true)">

        @* INPUT GROUP COLUMN *@
        <div class="col-md-6">
            @* SR LABEL *@
            <label for="@Html.IdFor(x => x.ConfirmPassword)" class="control-label sr-only">
                @LocalMembership.Constraints.PasswordConfirmationLabel
            </label>
            @* INPUT GROUP *@
            <div class="@Html.CssClassWhenIsPost(inputGroupCss)">
                <input type="password"
                       class="form-control @inputCss"
                       placeholder="@LocalMembership.Constraints.PasswordConfirmationLabel"
                       id="@Html.IdFor(x => x.ConfirmPassword)"
                       name="confirmPassword"
                       data-bind="value: confirmPassword"
                       value=""
                       required />

                <span class="input-group-addon validation @Html.CssClassWhenIsNotPost("hide")">
                    <i class="fa fa-fw fa-times error"></i>
                    <i class="fa fa-fw fa-spinner fa-spin spin-fast spinner"></i>
                    <i class="fa fa-fw fa-check success"></i>
                </span>
            </div>
        </div>

        @* VALIDATION MESSAGES COLUMNS *@
        <div class="col-md-6 validation help-block">
            @Html.ValidationMessageFor(x => x.ConfirmPassword)
        </div>
    </div>

    @* FORM SUBMIT BUTTON *@
    <div class="form-group">
        <div class="col-md-12">
            @{
                var buttonClass = ViewData.ModelState.IsValid ? null : "btn-danger";
                var readyClass = ViewData.ModelState.IsValid ? null : "hide";
                var errorClass = ViewData.ModelState.IsValid ? "hide" : null;
            }
            <button type="submit" class="pull-left btn btn-primary btn-lg @buttonClass">
                <i class="fa fa-fw fa-key @readyClass"></i>
                <i class="fa fa-fw fa-exclamation-triangle @errorClass"></i>
                <i class="fa fa-fw fa-spinner fa-spin spin-fast" style="display: none;"></i>
                Create password
            </button>
            <div class="has-error pull-left nudge-right @errorClass">
                <div class="help-block">
                    Could not create password due to above error(s).
                </div>
            </div>
        </div>
    </div>
</form>
